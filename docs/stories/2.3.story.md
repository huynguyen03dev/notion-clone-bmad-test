# Story 2.3: Task Creation and Management

## Story Metadata
- **Epic:** Epic 2 - Core Kanban Functionality
- **Story ID:** 2.3
- **Story Points:** 8
- **Priority:** High
- **Status:** Draft
- **Assigned Agent:** TBD
- **Dependencies:** Story 2.2 (Column Management)

## Story

**As a** user,
**I want** to create and manage tasks within my boards,
**so that** I can track individual work items and their details.

## Acceptance Criteria

1. "Add Task" button in each column with quick creation
2. Task cards displaying title, description preview, and metadata
3. Task detail modal with full editing capabilities
4. Task title, description, due date, and priority fields
5. Task deletion with confirmation dialog
6. Task duplication functionality
7. Character limits and validation for task fields
8. Auto-save functionality for task edits

## Tasks / Subtasks

- [ ] Task 1: Implement Task Creation API and Database Operations (AC: 1, 4, 7)
  - [ ] Create tRPC router for task operations (create, read, update, delete)
  - [ ] Implement Zod validation schemas for task input
  - [ ] Add database operations with proper error handling
  - [ ] Implement character limits and field validation
  - [ ] Add unit tests for API endpoints

- [ ] Task 2: Build Task Card Component (AC: 2)
  - [ ] Create TaskCard component with title, description preview, metadata display
  - [ ] Implement priority indicator styling (LOW/MEDIUM/HIGH)
  - [ ] Add due date display with formatting
  - [ ] Include assignee avatar display
  - [ ] Add hover states and click handlers
  - [ ] Implement responsive design for mobile

- [ ] Task 3: Create Task Detail Modal (AC: 3, 4, 8)
  - [ ] Build TaskDetailModal component with form fields
  - [ ] Implement rich text description editor
  - [ ] Add due date picker with calendar widget
  - [ ] Create priority selection dropdown
  - [ ] Implement auto-save functionality with debouncing
  - [ ] Add keyboard shortcuts (Escape to close, Ctrl+S to save)

- [ ] Task 4: Implement Quick Task Creation (AC: 1, 7)
  - [ ] Add "Add Task" button to each column
  - [ ] Create quick creation modal/inline form
  - [ ] Implement optimistic UI updates
  - [ ] Add validation and error handling
  - [ ] Ensure proper task positioning in column

- [ ] Task 5: Add Task Management Features (AC: 5, 6)
  - [ ] Implement task deletion with confirmation dialog
  - [ ] Add task duplication functionality
  - [ ] Create context menu for task actions
  - [ ] Add bulk operations support
  - [ ] Implement undo functionality for deletions

- [ ] Task 6: Integration and Testing (AC: All)
  - [ ] Write comprehensive unit tests for all components
  - [ ] Add integration tests for task CRUD operations
  - [ ] Implement E2E tests for complete task workflows
  - [ ] Test real-time collaboration features
  - [ ] Validate performance requirements (<500ms interactions)

## Dev Notes

### Previous Story Insights
From Story 2.2 (Column Management) completion:
- Established patterns for tRPC API structure and error handling
- Implemented optimistic UI updates with proper rollback mechanisms
- Used @dnd-kit library successfully for drag-and-drop interactions
- Achieved 100% test coverage with comprehensive error handling
- Followed TypeScript strict mode with proper interface definitions

### Data Models
**Task Model** [Source: docs/fullstack-architecture.md#data-models]:
```typescript
interface Task {
  id: string;
  title: string;
  description?: string | null;
  columnId: string;
  boardId: string;
  assigneeId?: string | null;
  priority: TaskPriority; // LOW, MEDIUM, HIGH
  dueDate?: Date | null;
  position: number;
  createdAt: Date;
  updatedAt: Date;
}

enum TaskPriority {
  LOW = 'LOW',
  MEDIUM = 'MEDIUM',
  HIGH = 'HIGH'
}
```

**Database Schema** [Source: docs/database-schema.md#task]:
- Title: VARCHAR(200) with validation
- Description: TEXT (optional)
- Priority: Enum with default MEDIUM
- Strategic indexes on boardId, assigneeId, dueDate, priority
- Composite unique constraint on (columnId, position)
- Cascade delete when column/board is deleted

### API Specifications
**tRPC Task Router** [Source: docs/fullstack-architecture.md#api-specification]:
- `task.create` - Create new task with validation
- `task.update` - Update task fields with optimistic updates
- `task.delete` - Soft delete with confirmation
- `task.duplicate` - Create copy of existing task
- `task.getByBoard` - Fetch all tasks for a board
- All endpoints include authentication and authorization checks
- Input validation using Zod schemas with character limits

### Component Specifications
**TaskCard Component** [Source: docs/front-end-spec.md#task-detail-modal]:
- Display: title, description preview, due date, priority indicator, assignee
- Hover states reveal task actions (edit, duplicate, delete)
- Click opens TaskDetailModal
- Drag-and-drop integration with @dnd-kit/sortable
- Responsive design with mobile touch targets (44px minimum)

**TaskDetailModal Component** [Source: docs/front-end-spec.md#task-detail-modal]:
- Large title field with auto-resize
- Rich text description editor
- Due date picker with calendar widget
- Priority dropdown (LOW/MEDIUM/HIGH)
- Assignment dropdown with user search
- Auto-save functionality with debouncing
- Real-time collaboration indicators
- Accessible form validation
- Modal can be resized/maximized

### File Locations
**Component Files** [Source: docs/fullstack-architecture.md#components]:
- `components/kanban/TaskCard.tsx` - Individual task display component
- `components/kanban/TaskDetailModal.tsx` - Task editing modal
- `components/kanban/TaskCreateButton.tsx` - Quick task creation
- `components/ui/` - shadcn/ui base components (Button, Modal, Form, etc.)

**API Files**:
- `pages/api/trpc/[trpc].ts` - tRPC API handler
- `server/api/routers/task.ts` - Task operations router
- `server/api/schemas/task.ts` - Zod validation schemas

**Database Files**:
- `prisma/schema.prisma` - Task model definition
- `prisma/migrations/` - Database migration files

### Testing Requirements
**Testing Strategy** [Source: docs/fullstack-architecture.md#testing-strategy]:
- **Unit Tests**: React Testing Library for components, Vitest for utilities
- **Integration Tests**: Supertest for API endpoints with real database
- **E2E Tests**: Playwright for complete user workflows
- **Performance Tests**: Validate <500ms interaction requirement
- **Accessibility Tests**: axe-core for WCAG AA compliance

**Test File Locations**:
- `__tests__/components/kanban/TaskCard.test.tsx`
- `__tests__/components/kanban/TaskDetailModal.test.tsx`
- `__tests__/api/task.test.ts`
- `e2e/task-management.spec.ts`

**Coverage Requirements**: 80%+ code coverage for all new components and API endpoints

### Technical Constraints
**Performance Requirements** [Source: docs/fullstack-architecture.md#performance-optimization]:
- <500ms interaction times for all task operations
- Optimistic UI updates with server reconciliation
- Component memoization for expensive renders
- Virtual scrolling for large task lists (>100 tasks)

**Real-time Features** [Source: docs/fullstack-architecture.md#real-time-architecture]:
- WebSocket integration for live task updates
- Presence tracking for collaborative editing
- Conflict resolution for simultaneous edits
- Optimistic updates with rollback on failure

**Security Requirements** [Source: docs/fullstack-architecture.md#security]:
- Input validation with XSS prevention
- Role-based access control (VIEWER/EDITOR/ADMIN)
- Rate limiting for API endpoints
- Audit logging for task operations

### Project Structure Notes
All file paths align with the established Next.js 14+ App Router structure. Components follow the shadcn/ui pattern with proper TypeScript interfaces. API routes use tRPC for type-safe communication between frontend and backend.

## Testing

### Testing Standards
**Framework**: Vitest + React Testing Library for components, Supertest for API testing
**Location**: `__tests__/` directory with mirrored folder structure
**Coverage**: Minimum 80% code coverage required
**E2E**: Playwright tests in `e2e/` directory
**Performance**: Automated validation of <500ms interaction requirement

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-04 | 1.0 | Initial story creation for task creation and management | BMad Master |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

## QA Results

*This section will be populated by the QA agent after story completion*
